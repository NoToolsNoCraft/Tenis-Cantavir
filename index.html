<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="pageTitle">Rezervacije teniskog terena</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            background-image: url(https://wallpapers.com/images/hd/720p-sports-background-1280-x-720-avyfumka5gj36c21.jpg);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .main-container {
            max-width: 900px;
            background-color: #fff;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            gap: 2rem;
            width: 100%;
        }

        @media (min-width: 768px) {
            .main-container {
                flex-direction: row;
            }
        }

        .section {
            flex: 1;
        }

        .text-center {
            text-align: center;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mb-6 {
            margin-bottom: 1.5rem;
        }

        .mb-8 {
            margin-bottom: 2rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        h1 {
            font-size: 2.25rem;
            font-weight: 700;
            color: #1f2937;
        }

        h2 {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1f2937;
        }

        p {
            color: #4b5563;
        }

        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .form-group input {
            width: 94%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }

        button {
            cursor: pointer;
            font-weight: 600;
            transition-property: background-color;
            transition-duration: 200ms;
        }

        .btn-primary {
            width: 100%;
            background-color: #2563eb;
            color: #fff;
            padding: 0.75rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .btn-filter {
            background-color: #e5e7eb;
            color: #1f2937;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .btn-filter.active {
            background-color: #2563eb;
            color: #fff;
        }

        .btn-delete {
            background-color: #ef4444;
            color: #fff;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
        }

        .btn-delete:hover {
            background-color: #dc2626;
        }

        .reservations-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .reservation-item {
            background-color: #f9fafb;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .reservation-item p {
            margin: 0;
            line-height: 1.5;
        }

        .reservation-item .name {
            font-weight: 600;
            font-size: 1.125rem;
        }

        .reservation-item .time {
            font-weight: 500;
            color: #374151;
        }

        .system-message {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            width: fit-content;
            padding: 0.75rem 1.5rem;
            background-color: #1f2937;
            color: #fff;
            font-size: 0.875rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none;
        }

        .system-message.show {
            opacity: 1;
        }
        
        .hidden {
            display: none;
        }

        .language-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: center;
        }

        .lang-btn {
            background-color: #e5e7eb;
            color: #1f2937;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }

        .lang-btn.active {
            background-color: #2563eb;
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="w-full text-center mb-8">
        <h1 data-translate="mainTitle" style="color: #ffffff; text-shadow: 2px 2px 4px black;">Teniski Tereni Čantavir</h1>
        <p data-translate="welcomeMessage" style="color: #ffffff; text-shadow: 2px 2px 4px black;">Dobrodošli na zvaničnu stranicu za rezervacije terena! Ovde možete da dodate, pregledate i upravljate svojim terminima za igru.<br>Dodajte svoje ime i vreme, a svi ostali igrači će videti vašu rezervaciju. Srećno igranje!</p>
        <div class="language-buttons">
            <button class="lang-btn active" data-lang="sr">Srpski</button>
            <button class="lang-btn" data-lang="hu">Magyar</button>
        </div>
    </div>

    <div class="main-container">
        <div class="section">
            <h2 data-translate="reserveSectionTitle">Rezervišite teren</h2>
            <p data-translate="reserveSectionDescription">Unesite svoje podatke da biste rezervisali termin.</p>

            <form id="reservationForm" class="flex flex-col gap-4">
                <div class="form-group">
                    <label for="playerName" data-translate="labelPlayerName">Vaše ime</label>
                    <input type="text" id="playerName" name="playerName" required>
                </div>
                <div class="form-group">
                    <label for="startTime" data-translate="labelStartTime">Vreme početka</label>
                    <input type="datetime-local" id="startTime" name="startTime" required>
                </div>
                <div class="form-group">
                    <label for="endTime" data-translate="labelEndTime">Vreme završetka</label>
                    <input type="datetime-local" id="endTime" name="endTime" required>
                </div>
                <button type="submit" class="btn-primary" data-translate="addReservationButton">
                    Dodajte rezervaciju
                </button>
            </form>
        </div>

        <div class="section">
            <h2 data-translate="reservationsSectionTitle">Predstojeće rezervacije</h2>
            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                <button id="showCurrentBtn" class="btn-filter active" data-translate="showCurrentButton">
                    Prikaži trenutne
                </button>
                <button id="showAllBtn" class="btn-filter" data-translate="showAllButton">
                    Prikaži sve
                </button>
            </div>
            <div id="loading" style="text-align: center; padding: 2rem;" class="hidden" data-translate="loadingMessage">
                Učitavanje rezervacija...
            </div>
            <div id="reservationsList" class="reservations-list">
            </div>
        </div>

        <div id="messageBox" class="system-message">
            Rezervacija uspešno dodata!
        </div>
    </div>

    <script>
        // *** IMPORTANT: REPLACE WITH YOUR GIST ID AND GITHUB TOKEN ***
        const GIST_ID = "2ec14059bbfe91870fb2e9fc927e3615";
        const GITHUB_TOKEN = "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";
        const GIST_FILE_NAME = "reservations.json";

        let reservationsCache = [];
        let currentViewMode = 'current';
        let currentLang = 'sr';

        const loadingDiv = document.getElementById('loading');
        const reservationsListDiv = document.getElementById('reservationsList');
        const form = document.getElementById('reservationForm');
        const messageBox = document.getElementById('messageBox');
        const showCurrentBtn = document.getElementById('showCurrentBtn');
        const showAllBtn = document.getElementById('showAllBtn');
        const startTimeInput = document.getElementById('startTime');
        const endTimeInput = document.getElementById('endTime');
        const langButtons = document.querySelectorAll('.lang-btn');

        const translations = {
            sr: {
                pageTitle: 'Rezervacije teniskog terena',
                mainTitle: 'Teniski Tereni Čantavir',
                welcomeMessage: 'Dobrodošli na zvaničnu stranicu za rezervacije terena! Ovde možete da dodate, pregledate i upravljate svojim terminima za igru.<br>Dodajte svoje ime i vreme, a svi ostali korisnici će videti vašu rezervaciju. Srećno igranje!',
                reserveSectionTitle: 'Rezervišite teren',
                reserveSectionDescription: 'Unesite svoje podatke da biste rezervisali termin.',
                labelPlayerName: 'Vaše ime',
                labelStartTime: 'Vreme početka',
                labelEndTime: 'Vreme završetka',
                addReservationButton: 'Dodajte rezervaciju',
                reservationsSectionTitle: 'Predstojeće rezervacije',
                showCurrentButton: 'Prikaži trenutne',
                showAllButton: 'Prikaži sve',
                loadingMessage: 'Učitavanje rezervacija...',
                noReservations: 'Nema rezervacija za prikaz u ovom pregledu.',
                deleteButton: 'Obrišite',
                messageSuccess: 'Rezervacija uspešno dodata!',
                messageFillFields: 'Molimo popunite sva polja.',
                messageTimeError: 'Vreme završetka mora biti nakon vremena početka.',
                messageDateError: 'Vreme početka i završetka mora biti istog dana.',
                messageConflict: 'Termin se preklapa sa postojećom rezervacijom. Molimo izaberite drugi termin.',
                messageAddError: 'Greška pri dodavanju rezervacije. Pogledajte konzolu za detalje.',
                messageDeleteSuccess: 'Rezervacija uspešno obrisana!',
                messageDeleteError: 'Greška pri brisanju rezervacije. Pogledajte konzolu za detalje.',
                messageDataError: 'Greška pri preuzimanju/čuvanju podataka. Pogledajte konzolu za detalje.',
                messageCleanup: (count) => `Uklonjeno ${count} isteklih rezervacija.`,
                reservationDetails: (date, start, end) => `Datum: ${date}<br>Vreme: ${start} - ${end}`
            },
            hu: {
                pageTitle: 'Teniszpálya foglalás',
                mainTitle: 'Csantavéri Teniszpályák',
                welcomeMessage: 'Üdvözöljük a hivatalos pályafoglalási oldalon! Itt hozzáadhatja, megtekintheti és kezelheti a játékidőpontokat.<br>Adja meg nevét és az időpontot, és a többi felhasználó is látni fogja a foglalását. Jó játékot!',
                reserveSectionTitle: 'Foglaljon pályát',
                reserveSectionDescription: 'Adja meg adatait a foglaláshoz.',
                labelPlayerName: 'Az Ön neve',
                labelStartTime: 'Kezdési idő',
                labelEndTime: 'Befejezési idő',
                addReservationButton: 'Foglalás hozzáadása',
                reservationsSectionTitle: 'Jövőbeli foglalások',
                showCurrentButton: 'Jelenlegi foglalások',
                showAllButton: 'Összes foglalás',
                loadingMessage: 'Foglalások betöltése...',
                noReservations: 'Nincsenek foglalások a megtekintéshez.',
                deleteButton: 'Törlés',
                messageSuccess: 'A foglalás sikeresen hozzáadva!',
                messageFillFields: 'Kérjük, töltse ki az összes mezőt.',
                messageTimeError: 'A befejezési időnek a kezdési idő után kell lennie.',
                messageDateError: 'A kezdési és befejezési időnek ugyanazon a napon kell lennie.',
                messageConflict: 'Az időpont ütközik egy meglévő foglalással. Kérjük, válasszon másik időpontot.',
                messageAddError: 'Hiba a foglalás hozzáadásakor. Kérjük, nézze meg a konzolt a részletekért.',
                messageDeleteSuccess: 'A foglalás sikeresen törölve!',
                messageDeleteError: 'Hiba a foglalás törlésekor. Kérjük, nézze meg a konzolt a részletekért.',
                messageDataError: 'Hiba az adatok letöltése/mentése során. Kérjük, nézze meg a konzolt a részletekért.',
                messageCleanup: (count) => `${count} lejárt foglalás törölve.`,
                reservationDetails: (date, start, end) => `Dátum: ${date}<br>Idő: ${start} - ${end}`
            }
        };

        function updateTranslations() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[currentLang][key]) {
                    if (el.tagName === 'TITLE') {
                        document.title = translations[currentLang][key];
                    } else {
                        el.innerHTML = translations[currentLang][key];
                    }
                }
            });
        }

        function showMessage(messageKey, ...args) {
            const messageText = translations[currentLang][messageKey];
            let content = messageText;
            if (typeof messageText === 'function') {
                content = messageText(...args);
            }
            messageBox.innerHTML = content;
            messageBox.classList.remove('hidden');
            messageBox.classList.add('show');
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 3000);
        }

        async function fetchReservations() {
            try {
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`);
                const gistData = await response.json();
                const content = gistData.files[GIST_FILE_NAME].content;
                reservationsCache = JSON.parse(content);
                renderReservations(reservationsCache);
            } catch (error) {
                console.error('Error fetching reservations:', error);
                showMessage("messageDataError");
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }

        async function saveReservations(data) {
            try {
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        files: {
                            [GIST_FILE_NAME]: {
                                content: JSON.stringify(data, null, 2)
                            }
                        }
                    })
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
            } catch (error) {
                console.error('Error saving reservations:', error);
                showMessage("messageDataError");
            }
        }

        function updateButtonStyles() {
            if (currentViewMode === 'current') {
                showCurrentBtn.classList.add('active');
                showAllBtn.classList.remove('active');
            } else {
                showAllBtn.classList.add('active');
                showCurrentBtn.classList.remove('active');
            }
        }
        
        function cleanupOldReservations(reservations) {
            const now = Date.now();
            const thirtyDaysInMs = 30 * 24 * 60 * 60 * 1000;
            const newReservations = reservations.filter(res => {
                const reservationEndTime = new Date(res.endTime).getTime();
                return now - reservationEndTime < thirtyDaysInMs;
            });
            if (newReservations.length < reservations.length) {
                const removedCount = reservations.length - newReservations.length;
                saveReservations(newReservations);
                showMessage("messageCleanup", removedCount);
            }
            return newReservations;
        }

        function renderReservations(reservations) {
            reservationsListDiv.innerHTML = '';
            
            const now = Date.now();
            const twelveHoursInMs = 12 * 60 * 60 * 1000;

            let filteredReservations = [...reservations];
            filteredReservations.sort((a, b) => new Date(a.startTime) - new Date(b.startTime));

            if (currentViewMode === 'current') {
                filteredReservations = filteredReservations.filter(res => {
                    const reservationEndTime = new Date(res.endTime).getTime();
                    return now - reservationEndTime < twelveHoursInMs;
                });
            }

            if (filteredReservations.length === 0) {
                reservationsListDiv.innerHTML = `<p style="text-align: center; margin-top: 1rem; color: #6b7280;">${translations[currentLang].noReservations}</p>`;
                return;
            }

            filteredReservations.forEach((data) => {
                const reservationItem = document.createElement('div');
                reservationItem.className = 'reservation-item';
                const startDate = new Date(data.startTime).toLocaleDateString(currentLang === 'hu' ? 'hu-HU' : 'sr-RS');
                const startTime = new Date(data.startTime).toLocaleTimeString(currentLang === 'hu' ? 'hu-HU' : 'sr-RS', { hour: '2-digit', minute: '2-digit', hour12: false });
                const endTime = new Date(data.endTime).toLocaleTimeString(currentLang === 'hu' ? 'hu-HU' : 'sr-RS', { hour: '2-digit', minute: '2-digit', hour12: false });

                const itemHtml = `
                    <div>
                        <p class="name">${data.name}</p>
                        <p class="time">${translations[currentLang].reservationDetails(startDate, startTime, endTime)}</p>
                    </div>
                    <button onclick="deleteReservation('${data.id}')" class="btn-delete">
                        ${translations[currentLang].deleteButton}
                    </button>
                `;
                reservationItem.innerHTML = itemHtml;
                reservationsListDiv.appendChild(reservationItem);
            });
        }
        
        window.deleteReservation = async (id) => {
            const newReservations = reservationsCache.filter(res => res.id !== id);
            await saveReservations(newReservations);
            reservationsCache = newReservations;
            renderReservations(reservationsCache);
            showMessage("messageDeleteSuccess");
        };

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('playerName').value;
            const startTimeStr = document.getElementById('startTime').value;
            const endTimeStr = document.getElementById('endTime').value;

            if (!name || !startTimeStr || !endTimeStr) {
                showMessage("messageFillFields");
                return;
            }

            const startTime = new Date(startTimeStr);
            const endTime = new Date(endTimeStr);

            if (endTime <= startTime) {
                showMessage("messageTimeError");
                return;
            }

            if (startTime.toDateString() !== endTime.toDateString()) {
                showMessage("messageDateError");
                return;
            }

            const isConflict = reservationsCache.some(reservation => {
                const existingStartTime = new Date(reservation.startTime);
                const existingEndTime = new Date(reservation.endTime);
                return (startTime < existingEndTime && endTime > existingStartTime);
            });

            if (isConflict) {
                showMessage("messageConflict");
                return;
            }

            const newReservation = {
                id: Date.now().toString(),
                name: name,
                startTime: startTimeStr,
                endTime: endTimeStr
            };
            
            reservationsCache.push(newReservation);
            await saveReservations(reservationsCache);
            renderReservations(reservationsCache);
            form.reset();
            showMessage("messageSuccess");
        });
        
        function init() {
            updateTranslations();
            fetchReservations().then(() => cleanupOldReservations(reservationsCache));
            
            langButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    langButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentLang = btn.getAttribute('data-lang');
                    updateTranslations();
                    renderReservations(reservationsCache);
                });
            });
            
            showCurrentBtn.addEventListener('click', () => {
                currentViewMode = 'current';
                updateButtonStyles();
                renderReservations(reservationsCache);
            });
            showAllBtn.addEventListener('click', () => {
                currentViewMode = 'all';
                updateButtonStyles();
                renderReservations(reservationsCache);
            });
            updateButtonStyles();

            startTimeInput.addEventListener('change', () => {
                if (startTimeInput.value) {
                    endTimeInput.value = startTimeInput.value;
                }
            });
        }

        window.onload = init;
    </script>
</body>
</html>
